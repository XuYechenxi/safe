# 图像生成与语义一致性检测系统

## 🚀 项目简介

这是一个基于 **Gradio** 的图像生成与语义一致性检测系统。系统采用模块化设计，支持多种生成模型（Stable Diffusion、CLIP融合、ITSC-GAN），并提供完整的图像生成、语义一致性检测、模型对比、数据分析等功能。系统具有专业的PC端界面设计，支持用户注册登录、历史记录管理、仪表盘统计等特性。

## ✨ 核心功能

### 1. 用户认证系统
- 🔐 用户注册和登录（带验证码）
- 🔑 安全的密码管理
- 📊 个人使用历史记录
- 🎨 专业的PC端登录界面设计

### 2. 图像生成功能
- 📝 通过文本描述生成图像
- 🤖 支持多种生成模型：
  - **SD基础模型** (Stable Diffusion v1.5)
  - **OpenAI CLIP融合模型**
  - **ITSC-GAN融合模型**
  - **一致性模型** (Consistency Model)
- ⚙️ 可调节参数（推理步数、引导强度、图像尺寸）
- 🖼️ 高质量图像输出
- 📋 快速提示词示例

### 3. 语义一致性检测
- 🔍 专门的一致性检测功能区
- 🧠 双模型检测（CLIP + ITSC-GAN融合）
- 📈 提供详细的相似度评分和分析报告
- 🎯 识别不一致的区域和原因
- 📊 细微差别分析

### 4. 模型对比功能
- 🔍 同时使用多个模型生成图像
- 📊 对比不同模型的生成效果
- 📈 自动生成对比总结报告
- 📋 表格和图表展示（柱状图、折线图）

### 5. 总结分析模块
- 📊 生成详细的对比分析报告
- 📈 可视化图表展示（表格、柱状图、折线图）
- 🔬 细微差别分析
- 💡 模型推荐建议

### 6. 仪表盘功能
- 📊 实时统计信息（总生成次数、今日生成、一致性通过率等）
- 📈 12小时内生成数据量分布（折线图）
- 🥧 模型使用占比（环形图）
- 📊 数据统计占比（饼图）
- ☁️ 热词词云图
- 🖼️ 不同模型的生成图片展示

### 7. 历史记录管理
- 📋 完整的历史生成记录
- 📊 详细的生成参数和检测结果
- 🕒 按时间顺序显示
- 🔍 支持快速查看和检索

## 📦 安装步骤

### 1. 克隆项目
   ```bash
   git clone <repository-url>
   cd photoevent
   ```

### 2. 安装依赖
   ```bash
   pip install -r requirements.txt
   ```

**注意**：
- 如果使用CPU，某些依赖（如 `flash-attn`）可能不需要安装
- 建议使用 Python 3.8+
- 推荐使用 CUDA 环境以获得更好的性能

### 3. 启动系统

#### 方式1：使用命令行
   ```bash
# 本地访问（默认端口8080）
python web_interface_gradio.py --port 8080 --local

# 服务器模式（允许局域网访问）
python web_interface_gradio.py --port 8080

# 自动查找可用端口
python web_interface_gradio.py --local

# 公网分享（生成临时公共链接）
python web_interface_gradio.py --share
   ```

#### 方式2：使用批处理文件（Windows）
- `启动服务器_本地美化版.bat` - 本地访问
- `启动服务器_公网分享_智能端口.bat` - 公网分享

### 4. 访问系统
- **本地访问**：打开浏览器，访问 `http://127.0.0.1:8080`
- **局域网访问**：访问 `http://<您的IP>:8080`
- **公网访问**：使用 `--share` 参数生成的公共链接

## 🎯 使用方法

### 1. 用户注册/登录
1. 首次使用需要注册账号
2. 输入用户名、邮箱和密码（至少6位）
3. 输入验证码（不区分大小写）
4. 完成注册后返回登录页面登录

### 2. 生成图像
1. 登录后进入"✨ 图像生成"标签页
2. 输入图像描述（例如："一只戴着太阳镜的猫坐在沙滩上"）
3. 选择生成模型（SD基础、CLIP融合、ITSC-GAN）
4. 调整参数（推理步数、引导强度、图像尺寸）
5. 点击"🚀 开始生成"按钮
6. 等待图像生成完成

### 3. 语义一致性检测
1. 进入"🔍 一致性检测"标签页
2. 上传图像或使用生成的图像
3. 输入对应的文本描述
4. 选择检测模型
5. 设置一致性阈值
6. 点击"🔍 开始检测"按钮
7. 查看详细的检测结果和分析报告

### 4. 模型对比
1. 进入"🔍 模型对比"标签页
2. 输入提示词
3. 设置生成参数
4. 点击"开始对比"按钮
5. 系统会使用多个模型同时生成并对比
6. 查看对比结果和自动生成的总结报告

### 5. 总结分析
1. 进入"📈 总结分析"标签页
2. 输入提示词
3. 点击"生成总结"按钮
4. 查看详细的对比分析报告，包括：
   - 表格数据对比
   - 柱状图对比
   - 折线图趋势
   - 细微差别分析
   - 模型推荐建议

### 6. 查看仪表盘
1. 进入"📊 仪表盘"标签页
2. 查看实时统计信息
3. 查看数据可视化图表
4. 查看不同模型的生成图片

### 7. 管理历史记录
1. 进入"📊 历史记录"标签页
2. 系统自动加载所有历史记录
3. 每条记录显示完整的生成参数和检测结果
4. 点击"🔄 刷新历史记录"按钮手动更新

## 📁 项目结构

```
photoevent/
├── web_interface_gradio.py          # 主Web界面文件（Gradio）
├── web_interface_new.py             # 备用界面文件
├── image_generation_service.py       # 图像生成服务模块
├── consistency_detection_service.py  # 一致性检测服务模块
├── model_comparison_service.py      # 模型对比服务模块
├── summary_analysis_service.py      # 总结分析服务模块
├── dashboard_service.py              # 仪表盘服务模块
├── image_processing.py              # 图像处理核心模块
├── consistency_model_generator.py   # 一致性模型生成器
├── semantic_consistency_detector.py  # 语义一致性检测器
├── database.py                      # 数据库操作模块
├── config_cm.py                     # 一致性模型配置
├── itsc_gan_modules.py              # ITSC-GAN模型模块
├── cm/                              # 一致性模型核心代码
│   ├── unet.py                      # UNet模型定义
│   ├── karras_diffusion.py          # Karras扩散采样
│   └── ...
├── requirements.txt                 # 依赖列表
├── README.md                        # 项目说明（本文件）
├── output/                          # 输出图像和结果
├── models/                          # 模型文件目录
├── examples/                        # 示例文件
└── datasets/                        # 数据集目录
```

## 🛠️ 技术栈

### 前端
- **Gradio** - Web界面框架
- **HTML/CSS/JavaScript** - 自定义界面样式和交互

### 后端
- **Python 3.8+** - 主要编程语言
- **PyTorch** - 深度学习框架
- **Transformers** - Hugging Face模型库
- **Diffusers** - 扩散模型库

### 机器学习模型
- **Stable Diffusion v1.5** - 基础生成模型
- **OpenAI CLIP** - 文本-图像对齐模型
- **ITSC-GAN** - 增强语义一致性检测
- **Consistency Model** - 单步生成模型

### 数据处理
- **Pillow (PIL)** - 图像处理
- **NumPy** - 数值计算
- **SQLAlchemy** - 数据库ORM

### 数据库
- **SQLite** - 轻量级数据库

## 🔧 配置说明

### 主要配置文件

- **`config_cm.py`** - 一致性模型配置
- **`database.py`** - 数据库配置和操作

### 默认参数

- **推理步数**：25（可调节10-100）
- **引导强度**：7.5（可调节1.0-20.0）
- **图像尺寸**：512x512（可调节512-1024）
- **一致性阈值**：0.3（可调节0.0-1.0）

### 服务器配置

- **默认端口**：8080（可自定义）
- **本地访问**：127.0.0.1
- **服务器模式**：0.0.0.0（允许局域网访问）
- **公网分享**：使用 `--share` 参数

## 📝 注意事项

1. **首次运行**：
   - 系统会自动创建数据库文件（`app.db`）
   - 首次加载模型可能需要较长时间（模型会自动下载到本地缓存）

2. **资源消耗**：
   - 图像生成和检测需要较高的计算资源
   - 建议使用GPU（CUDA）以获得更好的性能
   - CPU模式也可以运行，但速度较慢

3. **端口占用**：
   - 如果默认端口8080被占用，系统会自动查找可用端口
   - 可以使用 `--port` 参数指定端口

4. **模型下载**：
   - 模型首次使用时会自动从Hugging Face下载
   - 下载的模型会缓存在本地，后续使用无需重新下载

5. **依赖安装**：
   - 某些依赖（如 `flash-attn`）需要CUDA环境
   - CPU环境会自动跳过这些依赖

## 🚀 快速开始

### 最简单的启动方式

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 启动服务器
python web_interface_gradio.py --local

# 3. 打开浏览器访问
# http://127.0.0.1:8080
```

### 使用默认账号登录

- **用户名**：admin
- **密码**：admin123

（首次使用需要注册新账号）

## 🔍 功能模块说明

### 图像生成服务 (`image_generation_service.py`)
- 支持多种生成模型
- 参数可调节
- 自动保存图像

### 一致性检测服务 (`consistency_detection_service.py`)
- 双模型检测（CLIP + ITSC-GAN）
- 详细的检测结果展示
- 细微差别分析

### 模型对比服务 (`model_comparison_service.py`)
- 同时生成多个模型的结果
- 自动对比分析
- 生成对比报告

### 总结分析服务 (`summary_analysis_service.py`)
- 生成详细的对比总结
- 表格和图表展示
- 模型推荐建议

### 仪表盘服务 (`dashboard_service.py`)
- 实时统计数据
- 数据可视化
- 模型图片展示

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📄 许可证

本项目采用MIT许可证。

## 📞 联系方式

如有问题或建议，请通过以下方式联系：

- 提交Issue到项目仓库
- 发送邮件到项目维护者

---

**版本**: 2.0.0  
**最后更新**: 2025-11-27  
**更新内容**: 
- 重构为模块化设计
- 添加仪表盘、模型对比、总结分析等功能
- 优化界面设计，采用PC端专业布局
- 支持多种生成模型
- 完善用户认证和历史记录功能
